<?xml version="1.0" encoding="UTF-8" ?>
<definition xmlns="http://workflow.opencastproject.org">

  <id>uzk-migrate-publish</id>
  <title>UZK Migration: Publish a complete mediapackage from migration</title>
  <tags/>
  <description/>

  <configuration_panel/>

  <operations>

    <!-- Inspect the media -->
    <operation
      id="inspect"
      exception-handler-workflow="uzk-migrate-error"
      description="Inspecting audio and video streams">
      <configurations>
        <configuration key="overwrite">true</configuration>
        <configuration key="accept-no-media">false</configuration>
      </configurations>
    </operation>

    <!-- Apply access control lists from series to the mediapackage -->
    <operation
      id="series"
      exception-handler-workflow="uzk-migrate-error"
      description="Applying access control entries">
      <configurations>
        <configuration key="attach">*</configuration>
        <configuration key="apply-acl">true</configuration>
      </configurations>
    </operation>

    <!-- Tag the incoming metadata catalogs for publishing -->
    <operation
      id="tag"
      description="Tagging metadata catalogs for publication">
      <configurations>
        <configuration key="source-flavors">dublincore/*,security/*</configuration>
        <configuration key="target-tags">engage-download</configuration>
      </configurations>
    </operation>

    <!-- Publish to engage player -->
    <operation
      id="publish-engage"
      exception-handler-workflow="uzk-migrate-error"
      description="Publish final streaming part to Opencast Media Module">
      <configurations>
        <configuration key="download-source-flavors">dublincore/*,security/*</configuration>
        <configuration key="download-source-tags">engage-download</configuration>
        <configuration key="streaming-source-tags">engage-streaming</configuration>
        <configuration key="check-availability">true</configuration>
      </configurations>
    </operation>

    <operation
      id="archive"
      description="Archive publishing information">
      <configurations/>
    </operation>

    <!-- Clean up workspace -->
    <operation
      id="cleanup"
      fail-on-error="false"
      description="Remove temporary processing artifacts">
      <configurations/>
    </operation>

    <!-- Send email -->
    <operation id="send-email"
      fail-on-error="false"
      description="Send e-mail notification">
      <configurations>
        <configuration key="to">matterhorn-admin@uni-koeln.de</configuration>
        <configuration key="subject">Workflow 'migrate-publish' completed!</configuration>
        <configuration key="body-template-file">uzkDetails</configuration>
      </configurations>
    </operation>

  </operations>

</definition>
