<?xml version="1.0" encoding="UTF-8" ?>
<definition xmlns="http://workflow.opencastproject.org">

  <id>uzk-migrate-archive</id>
  <title>UZK Migration: Archive a complete mediapackage from migration</title>
  <tags/>
  <description>
    This workflow assumes it receives a complete mediapackage that was previously archive in an old Opencast system and archives all their elements.
  </description>

  <configuration_panel/>

  <operations>

    <!-- Inspect the media -->
    <operation
      id="inspect"
      exception-handler-workflow="uzk-migrate-error"
      description="Inspecting audio and video streams">
      <configurations>
        <configuration key="overwrite">true</configuration>
        <configuration key="accept-no-media">false</configuration>
      </configurations>
    </operation>

    <!-- Apply access control lists from series to the mediapackage -->
    <operation
      id="series"
      exception-handler-workflow="uzk-migrate-error"
      description="Applying access control entries">
      <configurations>
        <configuration key="attach">*</configuration>
        <configuration key="apply-acl">true</configuration>
      </configurations>
    </operation>

    <!-- Tag the incoming metadata catalogs for publishing -->
    <operation 
      id="tag" 
      description="Tagging metadata catalogs for publication">
      <configurations>
        <configuration key="source-flavors">dublincore/*,security/*</configuration>
        <configuration key="target-tags">+archive,+engage-download</configuration>
      </configurations>
    </operation>

    <!-- Tag the incoming metadata catalogs for publishing -->
    <operation 
      id="tag" 
      description="Tagging metadata catalogs for publication">
      <configurations>
        <configuration key="source-flavors">*/master</configuration>
        <configuration key="target-tags">+archive</configuration>
      </configurations>
    </operation>

    <!-- Archive material -->
    <operation
      id="archive"
      fail-on-error="true"
      exception-handler-workflow="uzk-migrate-error"
      description="Archive master recording after ingest/work">
      <configurations>
        <configuration key="source-tags">archive</configuration>
      </configurations>
    </operation>
    
    <!--operation
      id="archive"
      fail-on-error="true"
      exception-handler-workflow="uzk-migrate-error"
      description="Archive master recording after ingest/work">
      <configurations/>
    </operation-->

    <!-- Clean up workspace -->
    <operation
      id="cleanup"
      fail-on-error="false"
      description="Remove temporary processing artifacts">
      <configurations/>
    </operation>
    
    <!-- Send email -->
    <operation id="send-email" 
      fail-on-error="false"
      description="Send e-mail notification">
      <configurations>
        <configuration key="to">matterhorn-admin@uni-koeln.de</configuration>
        <configuration key="subject">Workflow 'migrate-archive' completed!</configuration>
        <configuration key="body-template-file">uzkDetails</configuration>
      </configurations>
    </operation>

  </operations>

</definition>
